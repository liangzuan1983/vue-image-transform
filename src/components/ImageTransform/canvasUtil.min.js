"undefined"==typeof canvasUtil&&(canvasUtil=new Object),function(){canvasUtil.perspective=function(t,a){if(t&&t.strokeStyle&&a&&a.width&&a.height){console.log("init finish");var e=document.createElement("canvas");e.width=parseInt(a.width),e.height=parseInt(a.height);var h=e.getContext("2d");h.drawImage(a,0,0,e.width,e.height);var s=document.createElement("canvas");s.width=t.canvas.width,s.height=t.canvas.height;var n=s.getContext("2d");this.p={ctxd:t,cvso:e,ctxo:h,ctxt:n}}};var t=canvasUtil.perspective.prototype;t.draw=function(t){for(var a=t[0][0],e=t[0][1],h=t[1][0],s=t[1][1],n=t[2][0],r=t[2][1],c=t[3][0],i=t[3][1],o=[Math.sqrt(Math.pow(a-h,2)+Math.pow(e-s,2)),Math.sqrt(Math.pow(h-n,2)+Math.pow(s-r,2)),Math.sqrt(Math.pow(n-c,2)+Math.pow(r-i,2)),Math.sqrt(Math.pow(c-a,2)+Math.pow(i-e,2))],v=this.p.cvso.width,p=this.p.cvso.height,d=0,w=0,g=0,l=0;l<4;l++){var f=0;f=l%2?o[l]/v:o[l]/p,f>w&&(d=l,w=f),0==o[l]&&g++}if(!(g>1)){var M=2,m=5*M,x=this.p.ctxo,u=this.p.ctxt;if(u.clearRect(0,0,u.canvas.width,u.canvas.height),d%2==0)for(var _=this.create_canvas_context(v,m),I=_.canvas,q=0;q<p;q+=M){var T=q/p,U=a+(c-a)*T,y=e+(i-e)*T,C=h+(n-h)*T,E=s+(r-s)*T,b=Math.atan((E-y)/(C-U)),P=Math.sqrt(Math.pow(C-U,2)+Math.pow(E-y,2))/v;_.setTransform(1,0,0,1,0,-q),_.drawImage(x.canvas,0,0),u.translate(U,y),u.rotate(b),u.scale(P,P),u.drawImage(I,0,0),u.setTransform(1,0,0,1,0,0)}else if(d%2==1)for(var _=this.create_canvas_context(m,p),I=_.canvas,j=0;j<v;j+=M){var T=j/v,U=a+(h-a)*T,y=e+(s-e)*T,C=c+(n-c)*T,E=i+(r-i)*T,b=Math.atan((U-C)/(E-y)),P=Math.sqrt(Math.pow(C-U,2)+Math.pow(E-y,2))/p;_.setTransform(1,0,0,1,-j,0),_.drawImage(x.canvas,0,0),u.translate(U,y),u.rotate(b),u.scale(P,P),u.drawImage(I,0,0),u.setTransform(1,0,0,1,0,0)}this.p.ctxd.save(),this.set_clipping_path(this.p.ctxd,[[a,e],[h,s],[n,r],[c,i]]),this.p.ctxd.drawImage(u.canvas,0,0),this.p.ctxd.restore()}},t.create_canvas_context=function(t,a){var e=document.createElement("canvas");e.width=t,e.height=a;var h=e.getContext("2d");return h},t.set_clipping_path=function(t,a){t.beginPath(),t.moveTo(a[0][0],a[0][1]);for(var e=1;e<a.length;e++)t.lineTo(a[e][0],a[e][1]);t.closePath(),t.clip()}}();